#!/usr/bin/python3
from carousel_common import *

ROOT = os.path.dirname(os.path.abspath(__file__))
FILELIST = os.path.join( ROOT, "photolist.txt") 
photos = os.path.join(ROOT, "photos")



def getPhotos( path ):
    all = glob.glob('{}/*.jpg'.format( path) )
    all.extend( glob.glob('{}/*.jpeg'.format( path) ) )
    all.extend( glob.glob('{}/*.png'.format( path) ) )
    
    #print('chunk,' , all)
    return all

def buildPhotoList():
    fileList = []

    fileLevels = collections.defaultdict(list)
    dirs = glob.glob('{}/*.[0-9]'.format(photos))
    #print(dirs)
    for i in dirs:
        number = int(i[-1])
        fileLevels[number].extend ( getPhotos(i)  )

    #print(fileLevels )


    oneIter = itertools.cycle(fileLevels[1])  # Take from this one until the other is empty
    twoIter = iter(fileLevels[2])
    try:
        while True:
            fileList.append(next(oneIter))
            fileList.append(next(twoIter))
            fileList.append(next(twoIter))
            fileList.append(next(twoIter))
    except StopIteration:
        pass

    return fileList

supervisor = Supervisor(FILELIST, buildPhotoList)
supervisor.startProcess( ["/usr/bin/feh","-F","-Z","-D","5","-f",FILELIST ]) 
supervisor.startProcess( ["/usr/bin/unclutter"] )
supervisor.monitor()


